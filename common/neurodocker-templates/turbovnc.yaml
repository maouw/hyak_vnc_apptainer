name: turbovnc
binaries:
  arguments:
    optional:
      version: "3.1"
  urls:
    "apt_3.1": &apt_latest "https://sourceforge.net/projects/turbovnc/files/3.1/turbovnc_3.1_amd64.deb"
    "apt_latest": *apt_latest
    "yum_3.1": &yum_latest "https://sourceforge.net/projects/turbovnc/files/3.1/turbovnc-3.1.x86_64.rpm"
    "yum_latest": *yum_latest
  dependencies:
    apt:
      - curl
  env:
    PATH: "/opt/TurboVNC/bin:$PATH"
    VNC_USER_DIR: "/tmp/${USER}-vnc"
  instructions: |

    {%- if self.pkg_manager == "apt" %}
        export DEBIAN_FRONTEND=noninteractive
        apt-get update -qq
        apt-get install -yq {{ " ".join(self._template["dependencies"]["apt"]) }}
        curl -fsSL --output turbovnc_installer {{ self.urls[self.pkg_manager + '_' + self.version] }}
        dpkg --install --force-depends turbovnc_installer && apt-get install --fix-broken -yq
        rm -rf turbovnc_installer
        apt-get install -yq --fix-broken
        apt-get clean -y
        rm -rf /var/lib/apt/lists/*
        echo '$vncUserDir = "$ENV{VNC_USER_DIR}";' >>/etc/turbovncserver.conf

    {%- else %}
        2>&1 echo "Unsupported package manager: {{ self.pkg_manager }}. Use an operating system with apt, like Ubuntu."
      exit 1
    {%- endif %}